<?php
require_once "config.php";
require_once "session.php";
if($_SERVER["REQUEST_METHOD"] == "POST" && isset($_POST['submit'])) {
  $fullname = trim($_POST['name']);
  $username = trim($_POST['username']);
  $password = trim($_POST['password']);
  $confirm_password = trim($_POST['confirm_password']);
  if($query = $db->prepare("SELECT * FROM user WHERE username = ?")) {
    $query->bind_param('s', $username);
    $query->execute();
    $query->store_result();
    if($query->num_rows > 0){
      echo "<h1>The username is already in use</h1>";
    } else {
      if(strlen($password) < 6){
        echo "<h1>Password must have at least 6 characters.</h1>";
      }
      if(empty($confirm_password)) {
        echo "<h1>Please enter confirm password.</h1>";
      } else {
        if(empty($error) && ($password != $confirm_password)) {
          echo "<h1>Password did not match.</h1>";
        }
      }
      if(empty($error)){
        $insertQuery = $db->prepare("INSERT INTO user(name, username, password) VALUES(?, ?, ?);");
        $insertQuery->bind_param("sss", $fullname, $username, $password);
        $result = $insertQuery->execute();
        if($result) {
          echo "<h1>Your registered successfully!</h1>";
        } else {
          echo "<h1>Something went wrong!</h1>";
        }
      }
    }
  }
  $query->close();
  $insertQuery->close();
  mysqli_close($db);
}
?>